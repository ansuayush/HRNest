
@model IList<Mitr.Models.Helpdesk.Ticket>


@section style{
    @System.Web.Optimization.Styles.Render("~/bundle/dataTablecss")
}
    <div class="inner-main pb-0">
        @Html.Partial("ListHeader_Partial", "My Ticket List")

        <div class="tab-main mb-5">
            <ul id="tabs" class="nav nav-tabs " role="tablist">
                <li class="nav-item"> <a id="tab-A" href="#active-log" class="nav-link active ripplelink" data-toggle="tab" role="tab"><i class="fal fa-envelope-open"></i>Pending</a> </li>
                <li class="nav-item"> <a id="tab-B" href="#leaves" class="nav-link ripplelink" data-toggle="tab" role="tab"><i class="fa fa-check" aria-hidden="true"></i>Resolved</a></li>
                <li class="nav-item"> <a id="tab-C" href="#Completed" class="nav-link ripplelink" data-toggle="tab" role="tab"><i class="fa fa-check" aria-hidden="true"></i>Completed</a></li>


            </ul>
            <div id="content" class="tab-content p-0" role="tablist">
                <div id="active-log" class="card tab-pane fade show active" role="tabpanel" aria-labelledby="tab-A">
                    <div class="card-header" role="tab" id="heading-A">
                        <h5 class="mb-0">
                            <!-- Note: `data-parent` removed from here -->
                            <a data-toggle="collapse" href="#collapse-A" aria-expanded="true" aria-controls="collapse-A"> <i class="fal fa-envelope-open"></i> Pending</a>
                        </h5>
                    </div>

                    <!-- Note: New place of `data-parent` -->
                    <div id="collapse-A" class="collapse show" data-parent="#content" role="tabpanel" aria-labelledby="heading-A">
                        <!--- -->
                        <div class="card-body p-0">
                            <div class="x_content table-currency">
                                <div class="table-responsive">

                                    <table id="Table1" class="table table-striped table-bordered dt-responsive nowrap tbltick new_width" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                        <thead>
                                            <tr>
                                                <th>S.no.</th>
                                                <th>Ticket No</th>
                                                <th>Status</th>
                                                <th>Category Name</th>
                                                <th>Sub Category</th>
                                                <th>Location Group</th>
                                                <th>RelatedTo</th>
                                                <th class="w-300">Message</th>
                                                <th>Inserted Details</th>


                                            </tr>
                                            <tr class="searchbar">
                                                <th class="searchhide"></th>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                                <th> </th>
                                                <th> </th>
                                                <th> </th>
                                                <th> </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @{ int Count = 0;}
                                            @foreach (Mitr.Models.Helpdesk.Ticket item in Model.Where(x=>x.StatusID !=2 && x.StatusID != 3))
                                            {
                                                Count++;
                                                <tr class="@(item.IsActive == true?"": "trrowred")">
                                                    <td>@Count</td>
                                                    <td>
                                                        @Html.Raw(clsApplicationSetting.GetSessionValue("Modify") == "True" ? "<a title='View Notes' onclick=\"ShowLoadingDialog();window.location='" + Url.Action("TicketNotes", new { src = clsApplicationSetting.EncryptQueryString(ViewBag.MenuID.ToString() + "*/Ticket/TicketNotes*" + item.TicketID + "") }) + "'\">" + @item.TicketNo + "</a>" : @item.TicketNo)
                                                    </td>
                                                    <td><a style="color:@item.StatusColor"> @item.DisplayName </a></td>
                                                    <td> @item.CategoryName</td>
                                                    <td>@item.SubCategoryName</td>
                                                    <td>@item.LocationGroupName</td>
                                                    <td>@item.RelatedTo</td>
                                                    <td>@item.Message</td>
                                                    <td class="hrmagin0">
                                                        <div>
                                                            @item.createdat<br>
                                                            @item.createdbyName<br>
                                                            <strong>IP: </strong>@item.IPAddress
                                                        </div>
                                                    </td>

                                                </tr>
                                            }
                                        </tbody>
                                    </table>


                                </div>
                            </div>
                        </div>
                        <!--- -->
                    </div>
                </div>
                <div id="leaves" class="card tab-pane fade" role="tabpanel" aria-labelledby="tab-B">
                    <div class="card-header" role="tab" id="heading-B">
                        <h5 class="mb-0"> <a class="collapsed" data-toggle="collapse" href="#collapse-B" aria-expanded="false" aria-controls="collapse-B"><i class="fa fa-check" aria-hidden="true"></i> Resolved</a> </h5>
                    </div>
                    <div id="collapse-B" class="collapse" data-parent="#content" role="tabpanel" aria-labelledby="heading-B">
                        <div class="card-body p-0">
                            <div class="x_content table-currency">
                                <div class="table-responsive">
                                    <table id="Table2" class="table table-striped table-bordered dt-responsive nowrap tbltick new_width" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                        <thead>
                                            <tr>
                                                <th>S.no.</th>
                                                <th>Ticket No</th>
                                                <th>Status</th>
                                                <th>Category Name</th>
                                                <th>Sub Category</th>
                                                <th>Location Group</th>
                                                <th>RelatedTo</th>
                                                <th class="w-300">Message</th>
                                                <th>Inserted Details</th>


                                            </tr>
                                            <tr class="searchbar">
                                                <th class="searchhide"></th>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                                <th> </th>
                                                <th> </th>
                                                <th> </th>
                                                <th> </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @{ int aCount = 0;}
                                            @foreach (Mitr.Models.Helpdesk.Ticket item in Model.Where(x => x.StatusID == 2))
                                            {
                                                aCount++;
                                                <tr class="@(item.IsActive == true?"": "trrowred")">
                                                    <td>@aCount</td>
                                                    <td>
                                                        @Html.Raw(clsApplicationSetting.GetSessionValue("Modify") == "True" ? "<a title='View Notes' onclick=\"ShowLoadingDialog();window.location='" + Url.Action("TicketNotes", new { src = clsApplicationSetting.EncryptQueryString(ViewBag.MenuID.ToString() + "*/Ticket/TicketNotes*" + item.TicketID + "") }) + "'\">" + @item.TicketNo + "</a>" : @item.TicketNo)
                                                    </td>
                                                    <td><a style="color:@item.StatusColor"> @item.DisplayName </a></td>
                                                    <td> @item.CategoryName</td>
                                                    <td>@item.SubCategoryName</td>
                                                    <td>@item.LocationGroupName</td>
                                                    <td>@item.RelatedTo</td>
                                                    <td>@item.Message</td>
                                                    <td class="hrmagin0">
                                                        <div>
                                                            @item.createdat<br>
                                                            @item.createdbyName<br>
                                                            <strong>IP: </strong>@item.IPAddress
                                                        </div>
                                                    </td>

                                                </tr>
                                            }
                                        </tbody>
                                    </table>



                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="Completed" class="card tab-pane fade" role="tabpanel" aria-labelledby="tab-C">
                    <div class="card-header" role="tab" id="heading-C">
                        <h5 class="mb-0"> <a class="collapsed" data-toggle="collapse" href="#collapse-C" aria-expanded="false" aria-controls="collapse-B"><i class="fa fa-check" aria-hidden="true"></i> Completed</a> </h5>
                    </div>
                    <div id="collapse-C" class="collapse" data-parent="#content" role="tabpanel" aria-labelledby="heading-C">
                        <div class="card-body p-0">
                            <div class="x_content table-currency">
                                <div class="table-responsive">

                                    <table id="Table3" class="table table-striped table-bordered dt-responsive nowrap tbltick new_width" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                        <thead>
                                            <tr>
                                                <th>S.no.</th>
                                                <th>Ticket No</th>
                                                <th>Status</th>
                                                <th>Category Name</th>
                                                <th>Sub Category</th>
                                                <th>Location Group</th>
                                                <th>RelatedTo</th>
                                                <th class="w-300">Message</th>
                                                <th>Inserted Details</th>


                                            </tr>
                                            <tr class="searchbar">
                                                <th class="searchhide"></th>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                                <th> </th>
                                                <th> </th>
                                                <th> </th>
                                                <th> </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @{ int aaCount = 0;}
                                            @foreach (Mitr.Models.Helpdesk.Ticket item in Model.Where(x => x.StatusID == 3))
                                            {
                                                aaCount++;
                                                <tr class="@(item.IsActive == true?"": "trrowred")">
                                                    <td>@aaCount</td>
                                                    <td>
                                                        @Html.Raw(clsApplicationSetting.GetSessionValue("Modify") == "True" ? "<a title='View Notes' onclick=\"ShowLoadingDialog();window.location='" + Url.Action("TicketNotes", new { src = clsApplicationSetting.EncryptQueryString(ViewBag.MenuID.ToString() + "*/Ticket/TicketNotes*" + item.TicketID + "") }) + "'\">" + @item.TicketNo + "</a>" : @item.TicketNo)
                                                    </td>
                                                    <td><a style="color:@item.StatusColor"> @item.DisplayName </a></td>
                                                    <td> @item.CategoryName</td>
                                                    <td>@item.SubCategoryName</td>
                                                    <td>@item.LocationGroupName</td>
                                                    <td>@item.RelatedTo</td>
                                                    <td>@item.Message</td>
                                                    <td class="hrmagin0">
                                                        <div>
                                                            @item.createdat<br>
                                                            @item.createdbyName<br>
                                                            <strong>IP: </strong>@item.IPAddress
                                                        </div>
                                                    </td>

                                                </tr>
                                            }
                                        </tbody>
                                    </table>


                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
<div class="modal fade pop-dgn" id="ViewModal">
    <div class="modal-dialog modal-md">
        <div class="modal-content">

            <div class="modal-header blk-gdn-btn">
                <h4 class="modal-title"><i class="fas fa-print"></i>Create Ticket </h4>
                <div class="close" data-dismiss="modal">&times;</div>
            </div>
            <!-- Modal body -->
            <div class="modal-body">
                <div id="TagetDiv"></div>
            </div>
        </div>
    </div>
</div>


@section scripts    {
    @System.Web.Optimization.Scripts.Render("~/bundle/dataTablesjs")
    <script src="~/assets/design/Scripts/AddInit.js?v=@clsApplicationSetting.GetWebConfigValue("Version")"></script>
    @System.Web.Optimization.Scripts.Render("~/bundle/unobtrusivejs")
    <script>

         $(document).ready(function () {
    DatatableScriptsWithColumnSearch("Table1");
             DatatableScriptsWithColumnSearch("Table2");
              DatatableScriptsWithColumnSearch("Table3");
         });


    function ListHeaderAdd(CMSID) {
        if (CMSID == undefined)
        {
            CMSID = 0;
        }
			$.ajax({
                url: "/Ticket/_CreateTicket",
				type: "Get",
				data: { src: EncryptQueryStringJSON(@ViewBag.MenuID+"*" + "/Ticket/_CreateTicket" + "*" + CMSID) },
                success: function (data)
                {
					$("#TagetDiv").empty();
                    $("#TagetDiv").html(data);
                    $("#ViewModal").modal("show");
                     var form = $("form")
                .removeData("validator")
                .removeData("unobtrusiveValidation");
                    $.validator.unobtrusive.parse(form);
                    $(".applyselect").select2();
				},
				error: function (er) {
					alert(er);

				}
			});
            }

    function OnSuccess(obj)
    {
        if (obj.Status) {
            window.location.reload();
        }
        else {
            FailToaster("Can't Update There is some problem");
        }

    }
    </script>
}

