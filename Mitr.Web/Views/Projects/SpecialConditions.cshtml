@model  Project.SpecialConditions
@{
    string MenuID = ViewBag.MenuID.ToString();
}
@Html.Partial("_ProjectHeader")


<div class="mb-100">
    @Html.HiddenFor(x => x.ID)
    <div class="inner-main mb-3 pb-0">

        @{
            Html.RenderAction("_AddSpecialConditions", new { src = clsApplicationSetting.EncryptQueryString(ViewBag.MenuID.ToString() + "*/Projects/_AddSpecialConditions*" + ViewBag.ID) });
        }
        <div class="row">
            <div class="col-sm-8">
                <div id="TargetDiv">
                    @{Html.RenderPartial("_ListSpecialConditions", Model.conditionList);}
                </div>
            </div>
        </div>

    </div>
    <div class="ftr-btn">
        

        @if (Model.Inactive == 0 && Model.ID>0)
        {
        <button type="button" onclick="MakeItLive();" class="btn mtr-o-grn " name="Command" value="Add"><i class="fas fa-paper-plane"></i>Make It Live</button>
        }
        @*<a class="btn blk-gdn-btn" data-toggle="tooltip" data-original-title="Go Next" href="@Url.Action("DonorsReport",new { src = clsApplicationSetting.EncryptFriendly(ViewBag.MenuID+"*"+"/Projects/DonorsReport*"+Model.ID) })">
            Next <i class="fas fa-angle-double-right m-0"></i>
        </a>*@
        <a class="btn cnl-btn" href="@Url.Action("BudgetDetails",new { src = clsApplicationSetting.EncryptFriendly(ViewBag.MenuID+"*"+"/Projects/BudgetDetails*"+Model.ID) })">
           <i class="fas fa-angle-double-left m-0"></i>  Back
        </a>
		<a class="btn cnl-btn" href="@Url.Action("ProjectRegistrationList",new { src = clsApplicationSetting.EncryptFriendly(ViewBag.MenuID+"*"+"/Projects/ProjectRegistrationList") })">
			<i class="fas fa-times"></i> Close
		</a>
    </div>


</div>


@section scripts    {
    @System.Web.Optimization.Scripts.Render("~/bundle/unobtrusivejs")
    @Html.IncludeVersionedJs(Url.Content("~/assets/design/scripts/AddInit.js"))
    @Html.IncludeVersionedJs(Url.Content("~/assets/design/js/jquery.autocomplete.min.js"))
    <script>
        function DeleteRecord(obj) {
            var Response = 0;
            var ID = $(obj).closest('tr').find('.hdnID').val();
            var Table = $(obj).closest('table');
            var TableID = $(Table).attr('ID');
            ConfirmMsgBox("Are you sure want to delete", '', function () {
                if (ID) {
                    var data = DelRecord_Common(ID, "ProjectSpecialConditions");
                    if (data.Status) {
                        $(obj).closest('tr').remove();
                    }
                    else {
                        FailToaster(data.SuccessMessage);

                    }
                }
            })
        }

        function OnSuccess(obj) {
            if (obj.Status) {
                SuccessToaster(obj.SuccessMessage);
                $("#TargetDiv").empty();
                $("#TargetDiv").html(obj.ViewAsString);
                CloseLoadingDialog();
                $("#Condition").val('');
                $("#AllocatedID").val('').trigger('change');
                $("#Chk").prop("checked", false);
            }
            else {
                CloseLoadingDialog();
                FailToaster(obj.SuccessMessage);

            }
        }


        // Initialize ajax autocomplete:
        var ProjectSpecialConditions = new Array();

        $(document).ready(function () {
            GetLatestTask();
        });
        function GetLatestTask() {
            ProjectSpecialConditions = [];
            var data = GetDropDownData(0,"ProjectSpecialConditions")
            $(data).each(function (i, news) {
                ProjectSpecialConditions.push({
                    value: news.Name,
                    data: news.Name
                });
            });
        }

        function GetAutofill(obj) {
            var ID = $(obj).attr('id');
            $("#" + ID).autocomplete({
                lookup: ProjectSpecialConditions,

                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    // use for when check 1st Word is searched world
                    //var re = new RegExp('\\b' + $.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    // Search Whole alpabate in string
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                },
                onSelect: function (suggestion) {
                    $('#selction-ajax').html('You selected: ' + suggestion.value + ', ' + suggestion.data);
                },
                onHint: function (hint) {
                    $('#autocomplete-ajax-x').val(hint);
                },
                onInvalidateSelection: function () {
                    $('#selction-ajax').html('You selected: none');
                }
            });
        }

        function MakeItLive() {
            ShowLoadingDialog();
            var ID = $("#ID").val();
            $.ajax({
                url: "/Projects/SetProjectMakeItLive",
                type: "Post",
                data: {
                    src: EncryptQueryStringJSON(MenuID + "*" + "/Projects/SetProjectMakeItLive" + "*" + ID)
                },
                success: function (obj) {
                    if (obj.Status) {
                        SuccessToaster(obj.SuccessMessage);
                        window.location.reload();
                    }
                    else {
                        CloseLoadingDialog();
                        FailToaster(obj.SuccessMessage);

                    }
                }
            });

        }
    </script>
}