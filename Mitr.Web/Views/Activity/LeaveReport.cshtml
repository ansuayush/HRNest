
@model Mitr.Models.LeaveReport
@{
	Layout = "~/Views/Shared/_Layout.cshtml";
}

@section style{
	@System.Web.Optimization.Styles.Render("~/bundle/dataTablecss")
}

<div class="inner-main defult-height">
	<div class="row">
		<div class="col-sm-12 mb-0">
			<h1 class="heading-one mb-0">Employee Master</h1>
		</div>
		<div class="col-sm-2  form-group align-self-end ">
			<label class="lbl-abs">Month</label>
			@Html.TextBoxFor(model => model.Date, new { @class = "form-control actdate h-30", @type = "month" })
			@Html.ValidationMessageFor(model => model.Date, "", new { @class = "text-danger" })
		</div>

		<div class="col-md-2  form-group">
			<label>Employee Type</label>
			@Html.DropDownListFor(model => model.Empid, new SelectList(ViewBag.emplist, "Id", "Name"), new { @class = "form-control applyselect " })

		</div>
		<div class="col-md-4  form-group align-self-center">
			<button type="submit" class="btn mtr-g-grn btn-l ripplelink mb-0" id="btnSearch" name="Command" value="Search"><i class="fas fa-search"></i>Search</button>
			<button type="button" class="btn mtr-g-grn btn-l ripplelink mb-0" id="btnExportAll" value="Search"><i class="fas fa-file-excel"></i>Export</button>
		</div>

	</div>
	<div id="TagetDiv">

	</div>

</div>
@section scripts    {
	@System.Web.Optimization.Scripts.Render("~/bundle/dataTablesjs")
	<script src="~/assets/design/Scripts/AddInit.js?v=@clsApplicationSetting.GetWebConfigValue("Version")"></script>
	@System.Web.Optimization.Scripts.Render("~/bundle/unobtrusivejs");
	<script src="~/assets/tableToExcel.js"></script>
	<script>
		$("#btnSearch").click(function () {
			var EmpId = parseInt($("#Empid").val());
			var Date = $("#Date").val();
			//if (EmpId > 0 && Date != "") {
			//	showtable(EmpId, Date);
			//}
			if ( Date != "") {
				showtable(EmpId, Date);
			}
			else {
				SuccessToaster('Please select Month');
			}

		});
		$("#btnExportAll").click(function (e) {
			exportReportToExcelAll()
		});
		function exportReportToExcelAll() {

			let table = document.getElementsByTagName("table"); // you can use document.getElementById('tableId') as well by providing id to the table tag
			TableToExcel.convert(table[0], { // html code may contain multiple tables so here we are refering to 1st table tag
				name: `Leave_Report.xlsx`, // fileName you could use any name
				sheet: {
					name: 'Sheet 1' // sheetName
				}
			});
		}
		function showtable(EmpId, Date) {
			ShowLoadingDialog();
			$.ajax({
				url: "/Activity/_LeaveReport",
				type: "Get",
				async: true,
				data: { src: EncryptQueryStringJSON(@ViewBag.MenuID+"*" + "/Activity/_LeaveReport" + "*" + EmpId + "*" + Date) },
				success: function (data) {
					debugger;
					$("#TagetDiv").empty();
					$("#TagetDiv").html(data);
					CloseLoadingDialog();



				},
				error: function (er) {
					alert(er);

				}
			});



	}
	</script>
}
