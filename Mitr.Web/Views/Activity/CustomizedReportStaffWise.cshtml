@model Mitr.Models.CustomizedReportStaffwise
@using System.Data;
@{
	Layout = "~/Views/Shared/_Layout.cshtml";
	var ReportData = TempData["dsdata"];
	DataSet ds = (DataSet)ReportData;
	string ReportType = Convert.ToString(TempData["ReporttypeProject"]);



	string fromdate = ""; string todate = "";
	string CompanyName = "", Address = "";

	string EMPName = "";
	string EMPCode = "";
	string DOJ = "";
	string LWD = "";
	if (ReportType == "StaffWise")
	{
		if (ds != null)
		{
			try
			{
				CompanyName = ds.Tables[1].Rows[0]["CompanyName"].ToString();
				Address = ds.Tables[1].Rows[0]["CompanyAddress"].ToString();
				fromdate = ds.Tables[1].Rows[0]["Fromdate"].ToString();
				todate = ds.Tables[1].Rows[0]["Todate"].ToString();
				EMPCode = ds.Tables[1].Rows[0]["emp_code"].ToString();
				EMPName = ds.Tables[1].Rows[0]["emp_name"].ToString();
				DOJ = ds.Tables[1].Rows[0]["DOJ"].ToString();
				LWD = ds.Tables[1].Rows[0]["LWD"].ToString();
			}
			catch
			{
			}

		}
	}

}

<link href="~/assets/design/css/bootstrap-multiselect.css" rel="stylesheet" />
<div class="inner-main defult-height ">
	<div class="row">
		<div class="col-sm-12 form-group align-self-center">
			<h1 class="heading-one mb-0">Individual Staff Salary and Benefit Report</h1>
		</div>



		@using (Html.BeginForm("CustomizedReportStaffWise", "Activity",
	  new { src = ViewBag.src }, FormMethod.Post,
	  new
	  {
		  name = "CustomizedReportStaffWiseForm",
		  id = "CustomizedReportStaffWiseForm",
		  enctype = "multipart/form-data"
	  }))
		{

			<div>
				<div class="col-sm-5">
					<div class="row">
						<div class="col-sm-6   form-group">
							<label>From Period</label>
							@Html.TextBoxFor(model => model.fromDate, new { @class = "form-control", type = "date" })
							@Html.ValidationMessageFor(model => model.fromDate, "", new { @class = "text-danger" })
						</div>

						<div class="col-sm-6   form-group">
							<label>To Period</label>
							@Html.TextBoxFor(model => model.toDate, new { @class = "form-control", type = "date" })
							@Html.ValidationMessageFor(model => model.toDate, "", new { @class = "text-danger" })
						</div>



						<div class="col-sm-6   form-group">
							<label>User</label>
							@Html.DropDownListFor(model => model.Empid, new SelectList(Model.EmpList, "Id", "Name"), "Select", new { @class = "form-control applyselect" })

							@Html.ValidationMessageFor(model => model.Empid, "", new { @class = "text-danger" })
						</div>




						<div class="col-sm-6   form-group">
							<label>
								Component
							</label>
							@Html.HiddenFor(x => Model.Earnings)
							<select class="applyselect" multiple="multiple" id="ddEarnings_IDs">
								<option Type="All">  All </option>
								@if (Model.EarningsList != null)
								{
									foreach (var item in Model.EarningsList)
									{
										if (string.IsNullOrEmpty(Model.Earnings))
										{
											<option value="@item.ID" Type="@item.Name">@item.Name--(@item.ExtraValue)</option>
										}

									}
								}
							</select>
							@Html.ValidationMessageFor(model => model.Earnings, "", new { @class = "text-danger" })
						</div>



						<div class="col-sm-12 align-self-end">

							<button type="submit" class="btn mtr-g-grn btn-l m-0 ripplelink" name="Command" value="Download"><i class="fas fa-file-excel"></i>Export to Excel</button>
						</div>


					</div>
				</div>
			</div>



			<div class="col-sm-12" id="tblProjectWiseSalary" style="display:none">
				<table class="table">
					<tr>
						<td colspan="25"></td>
					</tr>
					<tr style="background: #f2f2f2; padding: 10px; border-radius: 10px; margin-bottom: 10px;  text-align:center; width:100%;  padding:10px">
						<td width="120" rowspan="2" colspan="2" style="padding:15px; vertical-align: middle;"><img src="http://mitr2.sahajapps.com//assets/design/images/c3.png" height="50" alt=""></td>
						<td colspan="19" style="padding: 10px; text-align: left; font-size: 16px; vertical-align: middle;"><strong style="font-size:16px">@CompanyName </strong></td>
					</tr>
					<tr style="background: #f2f2f2; padding: 10px; border-radius: 10px; margin-bottom: 10px;  text-align:left; width:100%;  padding:10px">
						<td colspan="24"><small style="  display: block;text-align: left;font-weight: normal; font-size:14px">@Address</small></td>
					</tr>
					<tr>
						<td colspan="25"></td>
					</tr>

					<tr>
						<td><strong>Employee Name </strong></td>
						<td><strong>@EMPName </strong></td>
						<td><strong>DOJ</strong></td>
						<td><strong>@DOJ </strong></td>
						<td><strong>Report Period  From</strong></td>
						<td><strong>@fromdate </strong></td>

					</tr>
                    <tr>
                        <td><strong>Employee Code</strong></td>
                        <td><strong>@EMPCode </strong></td>

                        @if (@LWD == "01/01/1900")
                        {
                            <td></td>
                            <td></td>
                        }
                        else
                        {
                            <td><strong>LWD </strong></td>
                            <td><strong>@LWD </strong></td>
                        }

                        <td><strong>Report Period  To</strong></td>
                        <td><strong>@todate </strong></td>

                    </tr>

					<tr>
						<td colspan="5"></td>
					</tr>
                    <tr>
                        @if (ReportType == "StaffWise")
                        {

                            if (ds != null)
                            {
                                DataTable dt = ds.Tables[0];
                                <td style="width: 50px;" class="text-left">
                                    <strong>Month</strong>
                                </td>
                                for (int j = 1; j < dt.Columns.Count; j++)
                                {
                                    var column = dt.Columns[j].ToString();
                                    if (column == "SALARY")
                                    {
                                        <td style="width: 150px;" class="text-left"><strong>Salary(Earning)</strong></td>
                                    }
                                    else
                                    {
                                        if (column == "Fixed Benefits")
                                        {
                                            <td width="300" class="text-left"><strong>Fixed Benefits(Benefit)</strong></td>
                                        }
                                        else if (column == "Other Additions - Any Other")
                                        {
                                            <td width="300" class="text-left"><strong>Other Additions - Any Other(Other Earning)</strong></td>
                                        }
                                        else if (column == "Other Additions - Arrears")
                                        {
                                            <td width="300" class="text-left"><strong>Other Additions - Arrears(Other Earning)</strong></td>
                                        }
                                        else if (column == "OT")
                                        {
                                            <td width="300" class="text-left"><strong>OT(Other Earning)</strong></td>
                                        }
                                        else if (column == "VPF")
                                        {
                                            <td width="300" class="text-left"><strong>VPF(Deduction)</strong></td>
                                        }
                                        else if (column == "Internet Reimbursement")
                                        {
                                            <td width="300" class="text-left"><strong>Internet Reimbursement(Benefit)</strong></td>
                                        }
                                        else if (column == "Mobile Reimbursement")
                                        {
                                            <td width="300" class="text-left"><strong>Mobile Reimbursement(Benefit)</strong></td>
                                        }
                                        else if (column == "Life Insurance")
                                        {
                                            <td width="300" class="text-left"><strong>Life Insurance(Benefit)</strong></td>
                                        }
                                        else if (column == "Medical / Accident Insurance")
                                        {
                                            <td width="300" class="text-left"><strong>Medical / Accident Insurance(Benefit)</strong></td>
                                        }
                                        else if (column == "Medical Reimbursement")
                                        {
                                            <td width="300" class="text-left"><strong>Medical Reimbursement(Benefit)</strong></td>
                                        }
                                        else if (column == "Bonus")
                                        {
                                            <td width="300" class="text-left"><strong>Bonus(Benefit)</strong></td>
                                        }
                                        else if (column == "Gratuity")
                                        {
                                            <td width="300" class="text-left"><strong>Gratuity(Benefit)</strong></td>
                                        }
                                        else if (column == "AL Payable")
                                        {
                                            <td width="300" class="text-left"><strong>AL Payable(Other Earning)</strong></td>
                                        }
                                        else if (column == "NP Payable")
                                        {
                                            <td width="300" class="text-left"><strong>NP Payable(Other Earning)</strong></td>
                                        }
                                        @*else if (column == "Provident Fund C3Contribution")
                                        {
                                            <td width="300" class="text-left"><strong>Provident Fund Staff  Contributions(Benefit)</strong></td>
                                        }*@
                                        else if (column == "Special Benefits")
                                        {
                                            <td width="300" class="text-left"><strong>Special Benefits(Benefit)</strong></td>
                                        }
                                        else if (column == "TDS")
                                        {
                                            <td width="300" class="text-left"><strong>TDS(Deduction)</strong></td>
                                        }
                                        else if (column == "Professional Tax")
                                        {
                                            <td width="300" class="text-left"><strong>Professional Tax(Deduction)</strong></td>
                                        }
                                        else if (column == "Other Deduction - Advances")
                                        {
                                            <td width="300" class="text-left"><strong>Other Deduction - Advances(Deduction)</strong></td>
                                        }
                                        else if (column == "Other Deduction - Any other")
                                        {
                                            <td width="300" class="text-left"><strong>Other Deduction - Any other(Deduction)</strong></td>

                                        }
                                        else if (column == "AL Recovery")
                                        {
                                            <td width="300" class="text-left"><strong>AL Recovery(Deduction)</strong></td>

                                        }
                                        else if (column == "CL Recovery")
                                        {
                                            <td width="300" class="text-left"><strong>CL Recovery(Deduction)</strong></td>

                                        }
                                        else if (column == "NP Recovery")
                                        {
                                            <td width="300" class="text-left"><strong>NP Recovery(Deduction)</strong></td>

                                        }
                                        else
                                        {
                                            <td width="300" class="text-left"><strong>@column</strong></td>
                                        }
                                    }



                                }
                            }

                        }

                    </tr>
					@if (ds != null)
					{
						if (ReportType == "StaffWise")
						{


							int count = 1;
							var dt = ds.Tables[0];


							for (int i = count - 1; i < dt.Rows.Count; i++)
							{
								if (i == dt.Rows.Count - 1)
								{
									<tr style="background-color: #fffaf3">
										@for (int j = 0; j < dt.Columns.Count; j++)
										{
											string columnName = dt.Columns[j].ColumnName;
											if (columnName == "MonthYear")
											{
												<td style="width: 50px;">@dt.Rows[i][j].ToString()</td>

											}
											else
											{

												<td class="text-right" style="width: 150px;">
													<strong>@Convert.ToDouble(@dt.Rows[i][j]).ToString("#,##0")</strong>

												</td>


												// Print the value of the current row and column
											}
										}
									</tr>
								}
								else
								{
									<tr>
										@for (int j = 0; j < dt.Columns.Count; j++)
										{
											string columnName = dt.Columns[j].ColumnName;
											if (columnName == "MonthYear")
											{
												<td style="width: 50px;">@dt.Rows[i][j].ToString()</td>

											}
											else
											{

												<td class="text-right" style="width: 150px;">
													@*@dt.Rows[i][j].ToString()*@
													@Convert.ToDouble(@dt.Rows[i][j]).ToString("#,##0")
												</td>


												// Print the value of the current row and column
											}
										}
									</tr>
								}

							}

						}
					}




				</table>

			</div>

		}
	</div>
</div>

@section scripts    {

	@System.Web.Optimization.Scripts.Render("~/bundle/unobtrusivejs")
	@Html.IncludeVersionedJs(Url.Content("~/assets/design/Scripts/ToolTip.js"))
	@Html.IncludeVersionedJs(Url.Content("~/assets/design/scripts/AddInit.js"))
	@Html.IncludeVersionedJs(Url.Content("~/assets/tableToExcel.js"))




	<script>



        $(document).ready(function () {

            if ("@ReportType" == "StaffWise") {
                exportToExcelSahaj('tblProjectWiseSalary', 'IndividualStaffReport');
            }



        });
        function exportReportToExcel(Sheet, ReportName) {

            let table = document.getElementsByTagName("table"); // you can use document.getElementById('tableId') as well by providing id to the table tag
           // let table = document.getElementById("tblProjectWiseSalary");
            //let table = document.getElementsByClassName('tblProjectWiseSalary');
            TableToExcel.convert(table[0], { // html code may contain multiple tables so here we are refering to 1st table tag
                name: ReportName, // fileName you could use any name
                sheet: {
                    name: Sheet // sheetName
                }

            });
        }

	</script>


	<script>



		 $('#ddEarnings_IDs').change(function () {
            GetEValue()
        });
        function GetEValue() {

            var IDs =$("#ddEarnings_IDs option:selected").attr("Type");;
            $("#Earnings").val(IDs);
        }

			function BindTarget(args) {
			CloseLoadingDialog();
			$("#TargetDiv").empty();
			$("#TargetDiv").html(args);
			$('[data-toggle="tooltip"]').tooltip();
			$(".applyselect").select2();
		}

	</script>
}