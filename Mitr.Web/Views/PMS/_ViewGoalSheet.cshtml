@model PMS.GoalSheet.EMPGoalSheet

@using (Ajax.BeginForm("SubmitTeamSheet", "PMS",
			new { src = clsApplicationSetting.EncryptQueryString(ViewBag.MenuID.ToString() + "*/PMS/SubmitTeamSheet") },
			new AjaxOptions { HttpMethod = "POST", OnSuccess = "SubmitTeamSheetSuccess" },
		new { @id = "SubmitTeamSheetFrom" })
		)
{
	@Html.HiddenFor(x => Model.FYID)
	@Html.HiddenFor(x => Model.PMS_GSID)
	@Html.HiddenFor(x => Model.IsEdit)
	@Html.HiddenFor(x => Model.Approved)

	@Html.AntiForgeryToken()
	<div class="row">
		<div class="col-sm-4 form-group">
			<label>Year</label>
			<p>@Model.FYName</p>
		</div>
		<div class="col-sm-4 form-group">
			<label>Department</label>
			<p>@Model.Department</p>
		</div>
		<div class="col-sm-4 form-group">
			<label>Designation </label>
			<p>@Model.DesignationName</p>
		</div>
		<div class="col-sm-4 form-group">
			<label>Location</label>
			<p>@Model.LocationName</p>
		</div>
		<div class="col-sm-4 form-group">
			<label>Confirmer</label>
			<p>@Model.ConfirmerName</p>
		</div>
		<div class="col-sm-4 form-group">
			<label>Status</label>
			@if (Model.Approved == 1)
			{
				<p class="green-clr"><strong>@Model.Status</strong></p>
			}
			else
			{
				<p class="red-clr"><strong>@Model.Status</strong></p>
			}
		</div>
	</div>
	<div class="table-responsive">

		@if (Model.GoalSheetDet != null)
		{
			<div class="table-responsive">
				<table id="datatable" class="table mb-0  table-bordered  new_width ">
					<thead>
						<tr>
							<th width="33">S.No</th>
							<th width="300">Key Performance Area</th>
							<th>Key Performance Indicator</th>
							<th width="80">UOM</th>
							<th width="80">Target</th>
							<th width="30">Weightage</th>
						</tr>
					</thead>
					<tbody>
						@{ int count = 0;}
						@for (int i = 0; i < Model.GoalSheetDet.Count; i++)
						{
							count++;
							<tr>

								<td>
									@count
									@Html.HiddenFor(x => Model.GoalSheetDet[i].RPIndicator)
									@Html.HiddenFor(x => Model.GoalSheetDet[i].RTarget)
									@Html.HiddenFor(x => Model.GoalSheetDet[i].KPAID)
									@Html.HiddenFor(x => Model.GoalSheetDet[i].GoalSheetID)
									@Html.HiddenFor(x => Model.GoalSheetDet[i].PMS_GSDID)
									@*@Html.HiddenFor(x => Model.GoalSheetDet[i].UOMID)*@
								</td>
								<td class="hdftableid">
									@Model.GoalSheetDet[i].Area <sup class="red-clr" style="font-size: 10px"></sup>
									@Html.Hidden("hdfId", count)
								</td>
								<td>
									@*<p class="wb-spc-rgt">@Model.GoalSheetDet[i].PIndicator</p>
										<i class="fas fa-info-circle td-info" data-toggle="tooltip" data-placement="right" data-original-title="@Model.GoalSheetDet[i].DetRemarks"></i>*@

									@Html.TextAreaFor(model => Model.GoalSheetDet[i].PIndicator, new { @class = "form-control h-100 PIndicator", @placeholder = "Enter Key Performance Indicator", onkeypress = "return blockSpecialChar(event)", @disabled = "disabled" })
									@Html.ValidationMessageFor(model => Model.GoalSheetDet[i].PIndicator, "", new { @class = "text-danger" })
								</td>
								@*<td>@Model.GoalSheetDet[i].UOMName</td>*@
								<td class="text-left br-0">
									<select id="@Html.IdFor(x=>x.GoalSheetDet[i].UOMID)" name="@Html.NameFor(x=>x.GoalSheetDet[i].UOMID)" class="form-control applyselect ddlUM" data-val="true" data-val-required="Hey! You missed this field" onchange="FillTarget(this)">
										<option uomtype="" value="">Select</option>
										@if (ViewBag.UOMList != null)
										{
											foreach (var item in ViewBag.UOMList)
											{
												<option @(Model.GoalSheetDet[i].UOMID == item.PMSUOMID ? "selected" : "") uomtype="@item.Type" value="@item.PMSUOMID">@item.Name</option>
											}
										}
									</select>

								</td>
								<td class="text-left br-0">
									@*@Model.GoalSheetDet[i].Target*@
									@Html.TextBoxFor(model => Model.GoalSheetDet[i].Target, new { @class = "form-control Target text-right", @placeholder = "Enter Target", onkeypress = "return blockSpecialChar(event)", @disabled = "disabled" })

									@Html.ValidationMessageFor(model => Model.GoalSheetDet[i].Target, "", new { @class = "text-danger" })
								</td>
								<td class="text-right">
									@if (Model.Approved == 0)
									{
										@Html.TextBoxFor(model => Model.GoalSheetDet[i].Weight, new { @class = "form-control text-right", @placeholder = "Enter Weight", onkeypress = "return blockSpecialChar(event)" })
										@Html.ValidationMessageFor(model => Model.GoalSheetDet[i].Weight, "", new { @class = "text-danger" })
									}
									else if (Model.Approved == 3 && Model.IsEdit == 1)
									{
										@Html.TextBoxFor(model => Model.GoalSheetDet[i].Weight, new { @class = "form-control text-right", @placeholder = "Enter Weight", onkeypress = "return blockSpecialChar(event)" })
										@Html.ValidationMessageFor(model => Model.GoalSheetDet[i].Weight, "", new { @class = "text-danger" })
									}
									else if (Model.Approved == 3 )
									{
										@Html.TextBoxFor(model => Model.GoalSheetDet[i].Weight, new { @class = "form-control text-right", @placeholder = "Enter Weight", onkeypress = "return blockSpecialChar(event)" })
										@Html.ValidationMessageFor(model => Model.GoalSheetDet[i].Weight, "", new { @class = "text-danger" })
									}
									else
									{
										@Html.HiddenFor(model => Model.GoalSheetDet[i].Weight)
										<span>@Model.GoalSheetDet[i].Weight</span>

									}
								</td>


							</tr>
						}

					</tbody>
				</table>
			</div>
		}


	</div>

	<div class="row mt-3">
		<div class="col-md-8 mx-auto">
			<div class="form-group">
				<h3 class="subheading">Employee Overall Comment</h3>

				<p>@Model.Comment</p>
			</div>
			@if (Model.CommentList.Count > 0)
			{<div class="row">
					<div class="col-md-12">
						<h3 class="subheading"> Resubmission Comment</h3>
						<table id="datatable" class="table  table-bordered table-scroll nowrap tbltick mb-0 new_width dataTable" role="grid" aria-describedby="datatable_info">
							<tbody>
								<tr>
									<th class="tw-100">Date</th>
									<th>Comment By</th>
									<th class="tw-100">Name</th>
									<th>Comment</th>

								</tr>
								@foreach (var item in Model.CommentList)
								{
									<tr>
										<td>@item.createdat</td>
										<td>
											@item.Doctype
										</td>

										<td>@item.Name</td>
										<td>
											@item.Comment
										</td>
									</tr>

								}
							</tbody>
						</table>
					</div>

				</div>
			}
		</div>
	</div>
	if (Model.Approved == 0 || Model.Approved == 3)
	{
		<div id="divres" class="mt-2" style="display:none">
			<div class="row">
				<div class="col-sm-8 mx-auto form-group">
					<h3 class="subheading">Reason for Resubmission </h3>

					@Html.TextAreaFor(model => model.Reason, new { @class = "form-control", @placeholder = "Enter Name", onkeypress = "return blockSpecialChar(event)" })
					@Html.ValidationMessageFor(model => model.Reason, "", new { @class = "text-danger" })
					<div class="text-right">
						<button type="submit" name="Command" value="Resubmit" class="btn mt-2 mtr-o-grn ripplelink"><i class="fas fa-paper-plane"></i> Submit</button>
					</div>
				</div>
			</div>
		</div><div class="mt-3 text-center">
			<button type="button" class="btn cnl-btn ripplelink" data-dismiss="modal"><i class="fas fa-times"></i>Close</button>

			<button type="submit" name="Command" value="Approve" class="btn mtr-g-grn btn-l ripplelink btnApprove"> <i class="fas fa-check"></i>Approve</button>
			@if (Model.IsEdit == 0)
			{

				<a class="btn mtr-o-grn btn-l ripplelink pull-right" id="btnResubmit" data-toggle="tooltip" title="This will allow you to request the staff for resubmission of the form after taking into consideration your comments. However, you will not be able to do any edit in the form"><i class="fas fa-share"></i>Resubmit</a>
				<a class="btn mtr-g-grn btn-l ripplelink pull-right" onClick="openEdit();" id="btnEdit" data-toggle="tooltip" title="This will allow you to edit and submit the KPI as final document. Resubmit will not be allowed and team member will not be able to edit"><i class="fas fa-edit"></i>Edit</a>
			}
			else
			{

				<button type="submit" name="Command" value="Save" id="btnSave" class="btn mtr-g-grn btn-l ripplelink btnSave"> <i class="fas fa-check"></i>Save</button>
				<p class="alert alert-mitr alert-danger ">As you have chosen to EDIT goal sheet therefore option to RESUBMIT will not be available</p>
			}

			<button type="submit" name="Command" value="Save" id="btnSave" class="btn mtr-g-grn btn-l ripplelink btnSave" style="display:none"> <i class="fas fa-check"></i>Save</button>

		</div>
	}
	else
	{
		<div class="mt-3 pb-4 text-center ">
			<button type="button" class="btn cnl-btn ripplelink" data-dismiss="modal"><i class="fas fa-times"></i>Close</button>
		</div>
	}


}


