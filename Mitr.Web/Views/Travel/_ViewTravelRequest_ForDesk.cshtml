@model Mitr.Models.ViewTravelRequest_ForDesk

@{
	int IsBooked = 0;
	string TicketAsPerrUle = "", HotelRequired = "", MixedMode = "", CheckMode = "";
	IsBooked = Model.TravelDocumentsList.Select(x => x.isbooked).FirstOrDefault();
}
<div class="p-2">
	<ul class="list-unstyled dis-inline">
		<li>
			<strong>Request No</strong><br />
			@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.ReqNo).FirstOrDefault() : "")
		</li>

		<li><strong>Request Date</strong><br>@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.req_date).FirstOrDefault() : "")</li>
		<li>
			<strong>Request Type</strong><br />
			@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.RequestType).FirstOrDefault() : "")
		</li>

		@*<li>
				<strong>Generated by</strong><br />
				@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.Generatedby).FirstOrDefault() : "")
			</li>*@

		<li>
			<strong>Departure Date</strong><br />
			@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.DepartureDate).FirstOrDefault() : "")
		</li>

		<li>
			<strong>Approved On</strong><br>
			@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.approved_date).FirstOrDefault() : "")
		</li>
		<li><strong>Approved By</strong><br>@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.approvedby).FirstOrDefault() : "")</li>
		<li><strong>Project Code</strong><br>@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.ProjectName).FirstOrDefault() : "")</li>
		<li><strong>Nature of amendment </strong><br>@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.AmendmentType).FirstOrDefault() : "")</li>

		<li><strong>Exceptional approved on </strong><br>@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.ExpectApproveddate).FirstOrDefault() : "")</li>
		<li><strong>Exceptional Approved By </strong><br>@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.ExpName).FirstOrDefault() : "")</li>
	</ul>
	<div class="row">
		@*<div class="col-sm-9">
				<ul class="list-unstyled inline-icon dis-inline">
					@if (Model.RequestDetailList != null)
					{
						int ssscount = 0;
						foreach (var item in Model.RequestDetailList)
						{
							IsBooked = item.Isbooked;
							ssscount++;
							if (ssscount == 1)
							{
								CheckMode = item.Travel_mode;
								MixedMode = item.Travel_mode + " ,";
							}

							<li>
								<i class="fas fa-map-marker-alt"></i><strong>@item.fromCity to @item.toCity</strong>
								@Convert.ToDateTime(item.Travel_date).ToString("dd-MMM")
							</li>

							if (CheckMode != item.Travel_mode)
							{
								MixedMode = "Mixed Mode ,";
							}
							if (item.ticketbookingID == 1)
							{
								TicketAsPerrUle = "Ticket is As Per Rule ,";
							}

							if (item.hotelbookingID == 1)
							{
								HotelRequired = "Hotel Required ";
							}

						}
					}
				</ul>
			</div>*@
		<div class="col-sm-12 text-right">
			<a class="btn blk-gdn-btn btn-l ripplelink" data-toggle="modal" data-target="#mytravelrequest"><i class="fas fa-eye"></i>View Travel Data</a>
		</div>
	</div>
	@*<div class="info-box">
			<p>
				<strong> @(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.TripType).FirstOrDefault() + " :" : "") </strong>
				@MixedMode @TicketAsPerrUle @HotelRequired
			</p>
		</div>*@

	<div class="table-scrollable mx-h-170 trdsk-hgt  mb-4">
		<table class="table table-scroll act-table">
			<thead>
				<tr>
					<th class="td-10">S.No.</th>
					<th width="80">Travel Date</th>
					<th>From</th>
					<th>To</th>
					<th>Mode</th>
					<th>Ticket as per rule</th>
					<th>Hotel</th>
					<th>Travel Desk Name</th>
					<th width="50">Select</th>

					<th width="80">Transfer</th>
				</tr>
			</thead>
			<tbody>
				@if (Model.RequestDetailList != null)
				{
					int ssscount = 0;
					foreach (var item in Model.RequestDetailList)
					{
						IsBooked = item.Isbooked;
						ssscount++;
						<tr>
							<td class="hdfid">
								@ssscount
								<input type="hidden" name="TrDetId" value="@item.ID" />
							</td>
							<td class="hdfTraveldeskId">
								@item.Travel_date
								<input type="hidden" name="TrDeskEmpId" value="@item.TravelDeskEmployeeId" />
							</td>
							<td>@item.fromCity</td>
							<td>@item.toCity</td>
							<td>@item.Travel_mode</td>

							<td>

								@item.TicketBooking
								<button style="@(item.TicketBooking=="No"?"":"display:none")" tabindex="0" type="button" class=" td-info" data-popover-content="#unique_@ssscount" data-toggle="popover" data-placement="right" data-original-title="" title=""> <i class="fas fa-info-circle"></i> </button>
								<div id="unique_@ssscount" style="display:none;">
									<div class="popover-body">
										<div class="close">X</div>
										<ul class="list-unstyled text-clr tr-pophover">
											<li>
												<strong>Preferred Airline/Time</strong><br>
												<p>@item.ticketdetail</p>
											</li>
											<li>
												<strong>Justification</strong><br>
												<p>@item.justification</p>
											</li>
										</ul>
									</div>
								</div>


							</td>

							<td>@item.HotalName</td>
							<td>@item.TraveldeskName</td>
							<td class="text-center">
								@if (item.Itemlinebooked == 1)
								{
									<input type="checkbox" class="newwidth selectedId sltchk" disabled checked id="@item.TravelDetailID" value="@item.TravelDetailID">
								}
								else
								{
									<input type="checkbox" class="newwidth selectedId sltchk" onchange="chkbox(this)" id="@item.TravelDetailID" value="@item.TravelDetailID">
								}

								<label for="@item.TravelDetailID" class="m-0"></label>
							</td>

							@if (item.TravelDeskEmployeeId == Convert.ToInt32(clsApplicationSetting.GetSessionValue("EMPID")))
							{
								<td class="text-center">
								</td>
							}
							else
							{


								if (item.Travel_modeID == 3)
								{
									<td class="text-center">
									</td>
								}
								else
								{
									if (item.TransferTravelDeskUserId == 0)
									{
										<td class="text-left ">
											<button onclick="Transfer(this)" class="btn-none green-clr ">
												<i class="fa fa-check"></i>Transfer
											</button>
										</td>
									}
									else
									{
										<td class="text-left">
											Transferred
										</td>
									}

								}

							}

						</tr>
					}
				}

			</tbody>
		</table>
	</div>
	<div id="DivTravelDocumentView">
		@{Html.RenderPartial("_ViewTravelDocuments", Model.TravelDocumentsList);}
	</div>
	@if (IsBooked == 0)
	{
		<div class="text-right">
			<a class="btn mtr-g-grn btn-l ripplelink adddocument"><i class="fa fa-plus"></i>Add</a>
			@Html.Hidden("hdfversion", Model.RequestDetailList.Select(x => x.versionno).FirstOrDefault())
		</div>




	}
	@*<div class="text-right">

		<a href="@Url.Action("TravelDeskReportPrint",new { src = clsApplicationSetting.EncryptFriendly(ViewBag.MenuID+"*"+"/Travel/TravelDeskReportPrint*"+Model.RequestDetailList.Select(x=>x.travelreq_id).FirstOrDefault()) })" target="_blank"><i class="fas fa-eye"></i>Print</a>
	</div>*@
	@if (Model.TravelDocumentsList.Count > 0 && IsBooked == 0)
	{
		using (Ajax.BeginForm("ForwardToFinance_Desk", "Travel",
			  new { src = clsApplicationSetting.EncryptQueryString(ViewBag.MenuID.ToString() + "*/Travel/ForwardToFinance_Desk*" + ViewBag.TravelRequestID + @ViewBag.Id) },
			  new AjaxOptions { HttpMethod = "POST", OnSuccess = "ActionOnForwardToFinance_Desk", OnFailure = "ActionOnForwardToFinance_Desk" },
		  new { @id = "ForwardToFinance_DeskFrom", enctype = "multipart/form-data" })
		  )
		{
			@Html.HiddenFor(Model => Model.checkbox, new { @id = "chkid" })
			<div class=" text-center">
				<button type="submit" name="Command" value="Approved" class="btn mtr-o-grn btn-l ripplelink pull-right"><i class="fa fa-paper-plane" aria-hidden="true"></i> Request forward to Finance/User</button>
				
			</div>
		}
	}
<div>
	<a href="@Url.Action("TravelDeskReportPrint",new { src = clsApplicationSetting.EncryptFriendly(ViewBag.MenuID+"*"+"/Travel/TravelDeskReportPrint*"+Model.RequestDetailList.Select(x=>x.travelreq_id).FirstOrDefault()) })" target="_blank" class="btn mtr-g-grn"><i class="fas fa-print"></i>Print </a>
</div>
	@*<div class="text-center deskbtn">
		@if (Model.TravelDocumentsList.Count > 0 && IsBooked == 0)
		{
			using (Ajax.BeginForm("ForwardToFinance_Desk", "Travel",
				  new { src = clsApplicationSetting.EncryptQueryString(ViewBag.MenuID.ToString() + "*/Travel/ForwardToFinance_Desk*" + ViewBag.TravelRequestID + @ViewBag.Id) },
				  new AjaxOptions { HttpMethod = "POST", OnSuccess = "ActionOnForwardToFinance_Desk", OnFailure = "ActionOnForwardToFinance_Desk" },
			  new { @id = "ForwardToFinance_DeskFrom", enctype = "multipart/form-data" })
			  )
			{
				@Html.HiddenFor(Model => Model.checkbox, new { @id = "chkid" })
				
					<button type="submit" name="Command" value="Approved" class="btn mtr-o-grn btn-l ripplelink pull-right"><i class="fa fa-paper-plane" aria-hidden="true"></i> Request forward to Finance/User</button>
				
			}

		}

		<a href="@Url.Action("TravelDeskReportPrint",new { src = clsApplicationSetting.EncryptFriendly(ViewBag.MenuID+"*"+"/Travel/TravelDeskReportPrint*"+Model.RequestDetailList.Select(x=>x.travelreq_id).FirstOrDefault()) })" target="_blank" class="btn mtr-g-grn"><i class="fas fa-print"></i>Print </a>
	</div>*@
</div>



<!-- TASK Modal -->
<div class="modal fade pop-dgn" id="mytravelrequest">
	<div class="modal-dialog modal-md">
		<div class="modal-content">
			<div class="modal-header blk-gdn-btn">
				<h4 class="modal-title">Travel Preference & Other Details</h4>
				<div class="close" data-dismiss="modal">&times;</div>
			</div>
			<div class="modal-body p-0">
				<div class="p-3 pb-3">
					@*<div class="table-responsive ">
							<table class="table">
								<thead>
									<tr>
										<th>S.No.</th>
										<th>Travel Date</th>
										<th>From</th>
										<th>To</th>
										<th>Mode</th>
										<th>Ticket as per rule</th>
										<th>Specify</th>
										<th>Hotel</th>
									</tr>
								</thead>
								<tbody>
									@if (Model.RequestDetailList != null)
									{
										int count = 0;
										foreach (var item in Model.RequestDetailList)
										{
											count++;
									<tr>
										<td>@count</td>
										<td>@item.Travel_date </td>
										<td>@item.toCity </td>
										<td>@item.fromCity </td>
										<td>@item.Travel_mode </td>
										<td>@item.TicketBooking </td>
										<td>@item.justification </td>

										<td>@item.HotalName </td>
									</tr>
										}
									}

								</tbody>
							</table>
						</div>*@
					<strong>
						@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.EMPName).FirstOrDefault() : "")
					</strong>
					<table class="table mt-2">

						<tr>
							<td width="250">Gender </td>
							<td class="text-right">@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.Gender).FirstOrDefault() : "")</td>
						</tr>
						<tr>
							<td>Email Id </td>
							<td class="text-right">@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.EMPMail).FirstOrDefault() : "")</td>
						</tr>
						<tr>
							<td>Telephone</td>
							<td class="text-right">@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.Telephone).FirstOrDefault() : "")</td>
						</tr>
						<tr>
							<td>Date of birth</td>
							<td class="text-right">@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.Dateofbirth).FirstOrDefault() : "")</td>
						</tr>
						<tr>
							<td>Frequent Flyer No. </td>
							<td class="text-right">@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.Flyername).FirstOrDefault() : "")</td>
						</tr>
						<tr>
							<td>Meal preference</td>
							<td class="text-right">@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.Mealpreference).FirstOrDefault() : "")</td>
						</tr>
						<tr>
							<td>Seat preference</td>
							<td class="text-right">@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.Seatpreference).FirstOrDefault() : "")</td>
						</tr>
						<tr>
							<td width="250">Aadhaar No </td>
							<td class="text-right">@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.AdharNo).FirstOrDefault() : "")</td>
						</tr>
						<tr>
							<td width="250">Pan No </td>
							<td class="text-right">@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.PanNo).FirstOrDefault() : "")</td>
						</tr>

						@if (Model.RequestDetailList.Select(x => x.RequestType).FirstOrDefault() == "Domestic")
						{

						}
						else
						{
							<tr>
								<td>Passport No</td>
								<td class="text-right">@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.PassportNo).FirstOrDefault() : "")</td>
							</tr>
							<tr>
								<td>Passport Expiry Date</td>
								<td class="text-right">@(Model.RequestDetailList != null ? Model.RequestDetailList.Select(x => x.PassportExpiryDate).FirstOrDefault() : "")</td>
							</tr>
							<tr>
								<td>Visa Required</td>
								<td class="text-right">Yes</td>
							</tr>
							<tr>
								<td>Insurance Required</td>
								<td class="text-right">Yes</td>
							</tr>
						}


					</table>
					<div class="text-center">
						<button type="button" class="btn cnl-btn ripplelink  pull-right" data-dismiss="modal"><i class="fas fa-times"></i> Close</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>


<div class="modal fade pop-dgn" id="AddDocumentModal">
	<div class="modal-dialog mdl-lg">
		<div class="modal-content">
			<div class="modal-header blk-gdn-btn">
				<h4 class="modal-title">Add Documents</h4>
				<div class="close" data-dismiss="modal">&times;</div>
			</div>
			<div class="modal-body p-0">
				<div class="p-3 pb-3">
					@*@{Html.RenderAction("_AddTravelDocument", new { src = clsApplicationSetting.EncryptQueryString(ViewBag.MenuID.ToString() + "*/Travel/_AddTravelDocument*" + ViewBag.TravelRequestID) }); }*@
					<div id="targetAddDocument"></div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
    $('.adddocument').on('click', function (e) {
		var TravelRequestID = Number(@ViewBag.TravelRequestID);
		var versionno = $("#hdfversion").val();
		AddTravelDocument(TravelRequestID, versionno);
		 $("#AddDocumentModal").modal("show")

    });
	$('.editdocument').on('click', function (e) {
		var TravelRequestID = Number(@ViewBag.TravelRequestID);
		var versionno = $("#hdfversion").val();
		var Traveldocid = $(this).closest("tr").find("input:hidden[name=TDID]").val();
		EditTravelDocument(TravelRequestID, versionno, Traveldocid);
		 $("#AddDocumentModal").modal("show")

    });
         $('.deletedoc').on('click', function (e) {
                e.preventDefault();
                e.stopPropagation();
                var L = $(this).closest("tr").find("input:hidden[name=TDID]").val();
                DeleteTravelDoc(L,this);
          });

	$('[data-toggle="tooltip"]').tooltip();

	$("[data-toggle=popover]").popover({
		html: true,
		trigger: 'hover',
		content: function () {
			var content = $(this).attr("data-popover-content");
			return $(content).children(".popover-body").html();
		}
	});
	//$('.selectedId').change(function () {

		//var chkdata = $("#chkid").val();
		//var Ids = [];
		//if (this.checked) {
		//	var data = $("#chkid").val();
		//	if (data == "") {
		//		Ids = $(this).val();
		//			$('#chkid').val($(this).val());
		//	}
		//	else {
		//		Ids = $('#chkid').val() + "," + $(this).val();
		//	}

		//}
		//$("#chkid").val(Ids);



	//});
	var d = new Array();
	function chkbox(this1) {
		var s = this1.value;
		if (this1.checked) {
			d.push(s);
		} else {
			var index = d.indexOf(s);
			if (index > -1) {
				d.splice(index, 1);
			}
		}
		$("#chkid").val(d);
	}




</script>